<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SWMM-Docs: Building OWA SWMM From Source on Windows</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SWMM-Docs
   &#160;<span id="projectnumber">5.2.0.dev3</span>
   </div>
   <div id="projectbrief">Stormwater Management Model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Building OWA SWMM From Source on Windows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>by Michael E. Tryby</p>
<p>Created on: March 13, 2018</p>
<h3>Introduction</h3>
<p>Building OWA's fork of SWMM from source is a basic skill that all developers interested in contributing to the project should know how to perform. This document describes the build process step-by-step. You will learn</p>
<ol type="1">
<li>how to configure your machine to build the project locally;</li>
<li>how to obtain the project files using git;</li>
<li>how to use cmake to generate build files and build the project; and</li>
<li>how to use ctest and nrtest to perform unit and regression testing on the build artifacts produced. Be advised, you will need local admin privileges on your machine to follow this tutorial. Letâ€™s begin!</li>
</ol>
<h3>Dependencies</h3>
<p>Before the project can be built the required tools must be installed. The OWA SWMM project adheres to a platform compiler policy - for each platform there is a designated compiler. The platform compiler for Windows is Visual Studio cl, for Linux gcc, and for Mac OS clang. These instructions describe how to build SWMM on Windows. CMake is a cross platform build, testing, and packaging tool that is used to automate the SWMM build workflow. Boost is a free portable peer-reviewed C++ library. Unit tests are linked with Boost unit test libraries. Lastly, git is a free and open source distributed version control system. Git must be installed to obtain the project source code from the OWA SWMM repository found on GitHub.</p>
<h3>Summary of Dependencies</h3>
<ul>
<li>Platform Compiler<ul>
<li>Windows: Visual Studio 10.0 32-bit cl (version 16.00.40219.01 for 80x86)</li>
</ul>
</li>
<li>CMake (version 3.0.0 or greater)</li>
<li>Boost Libraries (version 1.58 or greater)</li>
<li>git (version 2.6.0 or greater)</li>
</ul>
<h4>Step 1 - Install Dependencies</h4>
<h6>Install Visual Studio 2010 Express and SP1</h6>
<p>Our current benchmark platform and compiler is Windows 32-bit Visual Studio 10 2010. Older versions of Visual Studio are available for download here:</p>
<p><a href="https://www.visualstudio.com/vs/older-downloads/">https://www.visualstudio.com/vs/older-downloads/</a></p>
<p>A service pack for Visual Studio 10 2010 is available here:</p>
<p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=34677">https://www.microsoft.com/en-us/download/details.aspx?id=34677</a></p>
<h6>Install Boost</h6>
<p>Boost binaries for Windows offer a convenient installation solution. Be sure to select download the boost installer exe that corresponds to the version of Visual Studio you have installed.</p>
<p><a href="https://sourceforge.net/projects/boost/files/boost-binaries/1.58.0/">https://sourceforge.net/projects/boost/files/boost-binaries/1.58.0/</a></p>
<p>Although newer version of Boost are available, a link to Boost 1.58 is provided. This is the library version that the unit tests have been written against. Older versions of Boost may not work. The default install location for the Boost</p>
<p>Libraries is <code>C:\local\boost_1_58_0</code></p>
<h6>Install Chocolatey, CMake, and git</h6>
<p>Chocolatey is a Windows package manager that makes installing some of these dependencies a little easier. When working with Chocolatey it is useful to have local admin privileges. Chocolatey is available here:</p>
<p><a href="https://chocolatey.org/install">https://chocolatey.org/install</a></p>
<p>Once Chocolately is installed, from a command prompt running with admin privileges issue the following commands</p>
<div class="fragment"><div class="line">&gt;choco install -y cmake --installargs &#39;ADD_CMAKE_TO_PATH=User&#39;</div><div class="line">&gt;choco install -y git --installargs /GitOnlyOnPath</div><div class="line">&gt;refreshenv</div></div><!-- fragment --><h6>Common Problems</h6>
<p>Using chocolatey requires a command prompt with admin privileges. Check to make sure installed applications are on the command path. Make note of the Boost Library install location.</p>
<h4>Step 2 - Build The Project</h4>
<p>As administrator open a Visual Studio 2010 Command Prompt. Change directories to the location where you wish to build the SWMM project. Now we will issue a series of commands to create a parent directory for the project root and clone the project from OWA's GitHub repository.</p>
<h6>Clone the SWMM Repository</h6>
<div class="fragment"><div class="line">&gt;mkdir OWA</div><div class="line">&gt;cd OWA</div><div class="line">&gt;git clone https://github.com/OpenWaterAnalytics/Stormwater-Management-Model.git</div><div class="line">&gt;cd Stormwater-Management-Model</div></div><!-- fragment --><p>The present working directory is now the project root SWMM. The directory contains the same files that are visibly present in the GitHub Repo by browsing to the URL <a href="https://github.com/OpenWaterAnalytics/stormwater-management-model/tree/develop">https://github.com/OpenWaterAnalytics/stormwater-management-model/tree/develop</a> .</p>
<p>Now we will create a build products directory and generate the platform build file using cmake.</p>
<h6>Generate the build files</h6>
<div class="fragment"><div class="line">&gt;mkdir buildprod</div><div class="line">&gt;cd buildprod</div><div class="line">&gt;set BOOST_ROOT=C:\local\boost_1_58_0</div><div class="line">&gt;cmake -G &quot;Visual Studio 10 2010&quot; -DBOOST_ROOT=&quot;%BOOST_ROOT%&quot; -DBoost_USE_STATIC_LIBS=&quot;ON&quot; ..</div></div><!-- fragment --><p>Now that the dependencies have been installed and the build system has been generated, building SWMM is a simple CMake command.</p>
<h6>Build SWMM</h6>
<div class="fragment"><div class="line">&gt;cmake --build . --config Debug</div></div><!-- fragment --><h6>Common Problems</h6>
<p>CMake may not be able to find the project CMakeLists.txt file or the Boost library install location.</p>
<h4>Step 3 - Testing</h4>
<p>Unit Testing uses Boost Unit Test library and CMake ctest as the test runner. Cmake has been configured to register tests with ctest as part of the build process.</p>
<h6>Unit Testing</h6>
<div class="fragment"><div class="line">&gt;cd tests</div><div class="line">&gt;ctest -C Debug</div></div><!-- fragment --><p>The unit tests run quietly. Ctest redirects stdout to a log file which can be found in the "tests\Testing\Temporary" folder. This is useful when a test fails.</p>
<p>Regression testing is somewhat more complicated because it relies on Python to execute SWMM for each test and compare the binary files and report files. To run regression tests first python and any required packages must be installed. If Python is already installed on your local machine the installation of miniconda can be skipped.</p>
<h6>Installing Regression Testing Dependencies</h6>
<div class="fragment"><div class="line">cd ..\..</div><div class="line">&gt;choco install -y miniconda --installargs &#39;/AddToPath=1&#39;</div><div class="line">&gt;refreshenv</div><div class="line">&gt;pip install -r tools/requirements-appveyor.txt</div></div><!-- fragment --><p>With Python and the necessary dependencies installed, regression testing can be run using the gen-config and run-nrtest helper scripts found in the tools folder. The script gen-config creates a json formatted file that describes the build artifact under test - run-swmm - and how to run it. The script run-nrtest calls nrtest execute and nrtest compare to perform the regression test.</p>
<p>To run the executable under test, nrtest needs the absolute path to it and a unique identifier for it such as the version number. The project build places build artifacts in the <code>buildprod\bin\</code> folder. On Windows the build configuration "Debug" or "Release" must also be indicated. On Windows it is also necessary to specify the path to the Python Scripts folder so the nrtest execute and compare commands can be found. You need to substitute bracketed fields below like "&lt;build id&gt;" with the values for your setup.</p>
<h6>Regression Testing</h6>
<div class="fragment"><div class="line">&gt;tools/gen-config.cmd &lt;Absolute path to exe under test&gt; &gt; tests/apps/swmm-&lt;build id&gt;.json</div><div class="line">&gt;tools/run-nrtest.cmd &lt;Absolute path to python scripts&gt; /tests/swmm-nrtestsuite &lt;build id&gt;</div></div><!-- fragment --><h6>Common Problems</h6>
<p>The nrtest script complains that it can't find manifest files.</p>
<p>That concludes this tutorial on building OWA SWMM from source on Windows. You have learned how to configure your machine satisfying project dependencies and how to acquire, build, and test SWMM on your local machine. To be sure, there is a lot more to learn, but this is a good start! Learn more by following the links provided below.</p>
<h3>Further Reading</h3>
<p>Visual Studio - <a href="https://msdn.microsoft.com/en-us/library/dd831853(v=vs.100).aspx">https://msdn.microsoft.com/en-us/library/dd831853(v=vs.100).aspx</a> CMake - <a href="https://cmake.org/documentation/">https://cmake.org/documentation/</a> Boost - <a href="http://www.boost.org/doc/">http://www.boost.org/doc/</a> git - <a href="https://git-scm.com/doc">https://git-scm.com/doc</a> Miniconda - <a href="https://conda.io/docs/user-guide/index.html">https://conda.io/docs/user-guide/index.html</a> nrtest - <a href="https://nrtest.readthedocs.io/en/latest/">https://nrtest.readthedocs.io/en/latest/</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
