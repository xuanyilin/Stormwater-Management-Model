by Michael E. Tryby

Created on\+: March 13, 2018

\subsubsection*{Introduction}

Building O\+WA\textquotesingle{}s fork of S\+W\+MM from source is a basic skill that all developers interested in contributing to the project should know how to perform. This document describes the build process step-\/by-\/step. You will learn


\begin{DoxyEnumerate}
\item how to configure your machine to build the project locally;
\item how to obtain the project files using git;
\item how to use cmake to generate build files and build the project; and
\item how to use ctest and nrtest to perform unit and regression testing on the build artifacts produced. Be advised, you will need local admin privileges on your machine to follow this tutorial. Letâ€™s begin!
\end{DoxyEnumerate}

\subsubsection*{Dependencies}

Before the project can be built the required tools must be installed. The O\+WA S\+W\+MM project adheres to a platform compiler policy -\/ for each platform there is a designated compiler. The platform compiler for Windows is Visual Studio cl, for Linux gcc, and for Mac OS clang. These instructions describe how to build S\+W\+MM on Windows. C\+Make is a cross platform build, testing, and packaging tool that is used to automate the S\+W\+MM build workflow. Boost is a free portable peer-\/reviewed C++ library. Unit tests are linked with Boost unit test libraries. Lastly, git is a free and open source distributed version control system. Git must be installed to obtain the project source code from the O\+WA S\+W\+MM repository found on Git\+Hub.

\subsubsection*{Summary of Dependencies}


\begin{DoxyItemize}
\item Platform Compiler
\begin{DoxyItemize}
\item Windows\+: Visual Studio 10.\+0 32-\/bit cl (version 16.\+00.\+40219.\+01 for 80x86)
\end{DoxyItemize}
\item C\+Make (version 3.\+0.\+0 or greater)
\item Boost Libraries (version 1.\+58 or greater)
\item git (version 2.\+6.\+0 or greater)
\end{DoxyItemize}

\paragraph*{Step 1 -\/ Install Dependencies}

\subparagraph*{Install Visual Studio 2010 Express and S\+P1}

Our current benchmark platform and compiler is Windows 32-\/bit Visual Studio 10 2010. Older versions of Visual Studio are available for download here\+:

\href{https://www.visualstudio.com/vs/older-downloads/}{\tt https\+://www.\+visualstudio.\+com/vs/older-\/downloads/}

A service pack for Visual Studio 10 2010 is available here\+:

\href{https://www.microsoft.com/en-us/download/details.aspx?id=34677}{\tt https\+://www.\+microsoft.\+com/en-\/us/download/details.\+aspx?id=34677}

\subparagraph*{Install Boost}

Boost binaries for Windows offer a convenient installation solution. Be sure to select download the boost installer exe that corresponds to the version of Visual Studio you have installed.

\href{https://sourceforge.net/projects/boost/files/boost-binaries/1.58.0/}{\tt https\+://sourceforge.\+net/projects/boost/files/boost-\/binaries/1.\+58.\+0/}

Although newer version of Boost are available, a link to Boost 1.\+58 is provided. This is the library version that the unit tests have been written against. Older versions of Boost may not work. The default install location for the Boost

Libraries is {\ttfamily C\+:\textbackslash{}local\textbackslash{}boost\+\_\+1\+\_\+58\+\_\+0}

\subparagraph*{Install Chocolatey, C\+Make, and git}

Chocolatey is a Windows package manager that makes installing some of these dependencies a little easier. When working with Chocolatey it is useful to have local admin privileges. Chocolatey is available here\+:

\href{https://chocolatey.org/install}{\tt https\+://chocolatey.\+org/install}

Once Chocolately is installed, from a command prompt running with admin privileges issue the following commands


\begin{DoxyCode}
\(\backslash\)>choco install -y cmake --installargs 'ADD\_CMAKE\_TO\_PATH=User'
\(\backslash\)>choco install -y git --installargs /GitOnlyOnPath
\(\backslash\)>refreshenv
\end{DoxyCode}


\subparagraph*{Common Problems}

Using chocolatey requires a command prompt with admin privileges. Check to make sure installed applications are on the command path. Make note of the Boost Library install location.

\paragraph*{Step 2 -\/ Build The Project}

As administrator open a Visual Studio 2010 Command Prompt. Change directories to the location where you wish to build the S\+W\+MM project. Now we will issue a series of commands to create a parent directory for the project root and clone the project from O\+WA\textquotesingle{}s Git\+Hub repository.

\subparagraph*{Clone the S\+W\+MM Repository}


\begin{DoxyCode}
\(\backslash\)>mkdir OWA
\(\backslash\)>cd OWA
\(\backslash\)>git clone https://github.com/OpenWaterAnalytics/Stormwater-Management-Model.git
\(\backslash\)>cd Stormwater-Management-Model
\end{DoxyCode}


The present working directory is now the project root S\+W\+MM. The directory contains the same files that are visibly present in the Git\+Hub Repo by browsing to the U\+RL \href{https://github.com/OpenWaterAnalytics/stormwater-management-model/tree/develop}{\tt https\+://github.\+com/\+Open\+Water\+Analytics/stormwater-\/management-\/model/tree/develop} .

Now we will create a build products directory and generate the platform build file using cmake.

\subparagraph*{Generate the build files}


\begin{DoxyCode}
\(\backslash\)>mkdir buildprod
\(\backslash\)>cd buildprod
\(\backslash\)>set BOOST\_ROOT=C:\(\backslash\)local\(\backslash\)boost\_1\_58\_0
\(\backslash\)>cmake -G "Visual Studio 10 2010" -DBOOST\_ROOT="%BOOST\_ROOT%" -DBoost\_USE\_STATIC\_LIBS="ON" ..
\end{DoxyCode}


Now that the dependencies have been installed and the build system has been generated, building S\+W\+MM is a simple C\+Make command.

\subparagraph*{Build S\+W\+MM}


\begin{DoxyCode}
\(\backslash\)>cmake --build . --config Debug
\end{DoxyCode}


\subparagraph*{Common Problems}

C\+Make may not be able to find the project C\+Make\+Lists.\+txt file or the Boost library install location.

\paragraph*{Step 3 -\/ Testing}

Unit Testing uses Boost Unit Test library and C\+Make ctest as the test runner. Cmake has been configured to register tests with ctest as part of the build process.

\subparagraph*{Unit Testing}


\begin{DoxyCode}
\(\backslash\)>cd tests
\(\backslash\)>ctest -C Debug
\end{DoxyCode}


The unit tests run quietly. Ctest redirects stdout to a log file which can be found in the \char`\"{}tests\textbackslash{}\+Testing\textbackslash{}\+Temporary\char`\"{} folder. This is useful when a test fails.

Regression testing is somewhat more complicated because it relies on Python to execute S\+W\+MM for each test and compare the binary files and report files. To run regression tests first python and any required packages must be installed. If Python is already installed on your local machine the installation of miniconda can be skipped.

\subparagraph*{Installing Regression Testing Dependencies}


\begin{DoxyCode}
cd ..\(\backslash\)..
\(\backslash\)>choco install -y miniconda --installargs '/AddToPath=1'
\(\backslash\)>refreshenv
\(\backslash\)>pip install -r tools/requirements-appveyor.txt
\end{DoxyCode}


With Python and the necessary dependencies installed, regression testing can be run using the gen-\/config and run-\/nrtest helper scripts found in the tools folder. The script gen-\/config creates a json formatted file that describes the build artifact under test -\/ run-\/swmm -\/ and how to run it. The script run-\/nrtest calls nrtest execute and nrtest compare to perform the regression test.

To run the executable under test, nrtest needs the absolute path to it and a unique identifier for it such as the version number. The project build places build artifacts in the {\ttfamily buildprod\textbackslash{}bin\textbackslash{}} folder. On Windows the build configuration \char`\"{}\+Debug\char`\"{} or \char`\"{}\+Release\char`\"{} must also be indicated. On Windows it is also necessary to specify the path to the Python Scripts folder so the nrtest execute and compare commands can be found. You need to substitute bracketed fields below like \char`\"{}$<$build id$>$\char`\"{} with the values for your setup.

\subparagraph*{Regression Testing}


\begin{DoxyCode}
\(\backslash\)>tools/gen-config.cmd <Absolute path to exe under test> > tests/apps/swmm-<build id>.json
\(\backslash\)>tools/run-nrtest.cmd <Absolute path to python scripts> /tests/swmm-nrtestsuite <build id>
\end{DoxyCode}


\subparagraph*{Common Problems}

The nrtest script complains that it can\textquotesingle{}t find manifest files.

That concludes this tutorial on building O\+WA S\+W\+MM from source on Windows. You have learned how to configure your machine satisfying project dependencies and how to acquire, build, and test S\+W\+MM on your local machine. To be sure, there is a lot more to learn, but this is a good start! Learn more by following the links provided below.

\subsubsection*{Further Reading}

Visual Studio -\/ \href{https://msdn.microsoft.com/en-us/library/dd831853(v=vs.100).aspx}{\tt https\+://msdn.\+microsoft.\+com/en-\/us/library/dd831853(v=vs.\+100).\+aspx} C\+Make -\/ \href{https://cmake.org/documentation/}{\tt https\+://cmake.\+org/documentation/} Boost -\/ \href{http://www.boost.org/doc/}{\tt http\+://www.\+boost.\+org/doc/} git -\/ \href{https://git-scm.com/doc}{\tt https\+://git-\/scm.\+com/doc} Miniconda -\/ \href{https://conda.io/docs/user-guide/index.html}{\tt https\+://conda.\+io/docs/user-\/guide/index.\+html} nrtest -\/ \href{https://nrtest.readthedocs.io/en/latest/}{\tt https\+://nrtest.\+readthedocs.\+io/en/latest/} 